/**
 * Created by YAO on 2018/9/12.
 */
!function(){"use strict";function t(){}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};window.__ab2__||(window.__ab2__={}),window.__ab2__.sendAb2=function(t,e){n._init(t),n._send(e)},t.prototype={constructor:t,UNKNOW:"",_objStr:Object.prototype.toString(),_init:function(t){try{this._config=t,this._getPropagationClick(t.event||"",t.abq||"",t.value||"")}catch(e){throw"the config option is not defined, please make sure the config is existed"}},_businessParams:function(t){var n=this._config.business;if(n.ev?n.ev=n.ev:null,n.ds?n.ds=n.ds:null,n.pl?n.pl=n.pl:null,"object"!==("undefined"==typeof n?"undefined":e(n)))throw"please make sure the type of params key 'business' is object !";return this._assign(n,t)},getUrl:function(){if(this._config.getUrl)return("https:"===window.location.protocol?"https://":"http://")+this._config.getUrl+"?";throw"the 'getUrl' is not defined in config, please make sure it is existed"},postUrl:function(){if(this._config.postUrl)return("https:"===window.location.protocol?"https://":"http://")+this._config.postUrl;throw"the 'postUrl' is defined in config, please make sure it is existed"},_getUa:function(){var t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),n=/(?:SymbianOS)/.test(t)||e,i=/(?:Android)/.test(t),s=/(?:Firefox)/.test(t),r=(/(?:Chrome|CriOS)/.test(t),/(?:iPad|PlayBook)/.test(t)||i&&!/(?:Mobile)/.test(t)||s&&/(?:Tablet)/.test(t)),o=/(?:iPhone)/.test(t)&&!r,a=!o&&!i&&!n;return{isTablet:r,isPhone:o,isAndroid:i,isPc:a}},_getCookie:function(t){var e=new RegExp(t+"s*=s*([^;]+);*"),n=e.exec(document.cookie);return n&&n.length>1?n[1]:this.UNKNOW},getHref:window.location.href,getRef:document.referrer,getSc:window.screen.width+"*"+window.screen.height,_getUrlParams:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!==n?unescape(n[2]):null},_getAppVersion:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xinapp",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"appver",n=window.navigator.userAgent;n=n.toLowerCase();var i=new RegExp(t+"*[/,=]s*([^s]+)").exec(n);return i&&i.length>1?i[1].split(" ")[0]:this._getUrlParams(e)||""},_getAppId:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"app_id";return this._getUrlParams(t)||""},_getXdid:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xdid";return this._getUrlParams(t)?this._getUrlParams(t).toLowerCase():""},_getUid:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uid",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"uid";return this._getCookie(t)||this._getUrlParams(e)||""},_getCid:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"XIN_UID_CK";return this._getCookie(t)||""},_getCity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"XIN_LOCATION_CITY",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cityid",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cityid",s=this._getCookie(t);if(!s)return this._getUrlParams(i)||-1;try{return"object"===e(JSON.parse(decodeURIComponent(s)))?JSON.parse(decodeURIComponent(s))[n]:JSON.parse(decodeURIComponent(s))}catch(r){return"object"===("undefined"==typeof s?"undefined":e(s))?s[n]:s}},_getPlatform:function(){var t=this._getUa(),e=this._config,n=this.getHref.match(/:\/\/([A-Za-z]*)\./),i=this.getHref.split(".")?this.getHref.split(".").indexOf("www")>-1:!1;return t.isPhone&&this._getAppVersion(e.appVersion,"")?"m-ios":t.isAndroid&&this._getAppVersion(e.appVersion,"")?"m-android":t.isPc&&(n&&n.indexOf("www")>-1||i)?"www":"m"},_getPageId:function(){return window.PAGE_ID||window.location.href.split("?")[0]},_getSource:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"source";return this._getUrlParams(t)||""},_getChannel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"channel";return this._getUrlParams(t)||""},_getAbversion:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"abversion";return this._getUrlParams(t)||""},_getNet:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"net";return this._getUrlParams(t)||""},_getLocation:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"location";return this._getUrlParams(t)||""},_assign:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},_getOptions:function(){var t=this._config,e={app:this._getAppVersion(t.appVersion,t.appVerForUrl),uid:this._getUid(t.uid,t.uidForUrl),cid:this._getCid(t.cid),cityid:this._getCity(t.cityIdForCookie,t.cityId,t.cityIdForUrl),platform:this._getPlatform(),source:this._getSource(t.source),channel:this._getChannel(t.channel),sc:this.getSc,abversion:this._getAbversion(t.abversion),pageid:this._getPageId(),url:encodeURIComponent(this.getHref),ref:"undefined"===encodeURIComponent(this.getRef)?"":encodeURIComponent(this.getRef),app_id:this._getAppId(t.appId),xdid:this._getXdid(t.xdid),ts:(new Date).getTime(),net:this._getNet(t.net),location:this._getLocation(t.location)},n=this._businessParams();return this._assign(e,n)},_collectAllOptionsForGet:function(){var t="",e=this._getOptions();for(var n in e)t=t+n+"="+e[n]+"&";return t.substring(0,t.length-1)},_ajaxPost:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._config.success,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._config.failed,i=null;i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.open("POST",this.postUrl(),!0),i.setRequestHeader("Content-type","multipart/form-data"),i.send(t),i.onreadystatechange=function(){if(4===i.readyState)if(403===i.status)e(i.responseText);else if(n)throw n(i.status),"this request is failed£¬the status is "+i.status+"please try again£¡"}},_ajaxGet:function(t){var e=new Image;e.style.display="none",e.src=this.getUrl()+t,document.body.appendChild(e)},_getPropagationClick:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"event",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ABQ",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";document.addEventListener("click",function(s){if(s.target.getAttribute(t)===n){if(!s.target.getAttribute(i))throw"the attribute 'value' is not defined,please make sure the value is existed";var r=s.target.getAttribute(i);if("object"!==("undefined"==typeof r?"undefined":e(r)))throw"the attribute 'value' is must be a object, the key is params key, the value is params value.";r.type="c",this._businessParams(r),this._send("post")}},!1)},_send:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"post",e=this._collectAllOptionsForGet();this._ajaxGet("post"===t?e:e)}};var n=new t}();